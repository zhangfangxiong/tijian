<?phpclass Controller_Tpa_Admin_Base extends Yaf_Controller{    /**     * 是否进行登录检测     *      * @var unknown     */    protected $bCheckLogin = true;    /**     * 当前用户     *      * @var unknown     */    protected $aCurrUser = null;    /**     * 当前城市     *      * @var unknown     */    protected $iCurrCityID = null;    protected $aCurrCity = null;        protected $aSex = null;        protected $aRole = null;        protected $aDeptSet = null;    protected function _assignUrl()    {        //快递相关        $this->assign('sExpressUrl', '/tpa/admin/express/list/');        $this->assign('sAddExpressUrl', '/tpa/admin/express/add/');        $this->assign('sDelExpressUrl', '/tpa/admin/express/del/');        $this->assign('sPrintExpressUrl', '/tpa/admin/express/print/');        //受理相关        $this->assign('sAcceptEmployeeUrl', '/tpa/admin/accept/employee/');        $this->assign('sAcceptCaseUrl', '/tpa/admin/accept/case/');        $this->assign('sAcceptAddCaseUrl', '/tpa/admin/accept/addcase/');        $this->assign('sAcceptViewCaseUrl', '/tpa/admin/accept/viewcase/');        $this->assign('sAcceptPrintCaseUrl', '/tpa/admin/accept/print/');        $this->assign('sAcceptErrorUrl', '/tpa/admin/accept/error/');        $this->assign('sAcceptBackUrl', '/tpa/admin/accept/back/');        $this->assign('sAcceptAddErrorUrl', '/tpa/admin/accept/adderror/');                $this->assign('aDeptSet', $this->aDeptSet);    }        /**     * 加载基础数据     */    protected function loadConfig() {        $this->aSex = Yaf_G::getConf(null, 'aSex', 'tpa');                $this->aRole = Model_Tpa_Role::getPair(['iStatus' => Model_Tpa_Role::STATUS_VALID], 'iRoleID', 'sRoleName');                $this->aDeptSet = Model_Tpa_Dept::getPair(['iStatus' => Model_Tpa_Role::STATUS_VALID], 'iAutoID', 'sDeptName');    }    /**     * 执行Action前执行     *      * @see Yaf_Controller::actionBefore()     */    public function actionBefore ()    {        $this->loadConfig();                $sProjectName = strtolower($this->getRequest()->getProjectName());        //载入项目配置文件        if (!empty($sProjectName)) {            Yaf_G::loadConfig($sProjectName);        }                $this->_frame = 'tpaadmin.phtml';        if ($this->bCheckLogin) {            // 当前用户            $this->aCurrUser = Util_Cookie::get(Yaf_G::getConf('authkey', 'cookie', 'tpa'));            if (empty($this->aCurrUser)) {                //暂时屏蔽，楚原做好登陆后再打开                return $this->redirect('/tpa/admin/login');            }            // 当前城市            $this->iCurrCityID = Util_Cookie::get('tpa_city');            if (empty($this->iCurrCityID)) {                $this->iCurrCityID = $this->aCurrUser['iCityID'];            }            $this->aCurrCity = Model_Tpa_City::getDetail($this->iCurrCityID);        }                $this->assign('sProjectName', $sProjectName);        $this->assign('sStaticRoot', 'http://' . Yaf_G::getConf('static', 'domain'));    }    /**     * 执行Action后的操作     *      * @see Yaf_Controller::actionAfter()     */    public function actionAfter ()    {        if ($this->autoRender() == true) {            if (! empty($this->aCurrUser)) {                $this->assign('aCurrUser', $this->aCurrUser);                                // 菜单列表                $aMenuTree = Model_Tpa_Menu::getTree($this->aCurrUser['iUserID']);                $aMenuTree = Model_Tpa_Menu::getTree();                $this->assign('__aMenuTree__', $aMenuTree);                $this->assign('iCurrCityID', $this->iCurrCityID);                $this->assign('aCurrCity', $this->aCurrCity);                                // 城市列表                $this->assign('__aCityList__', Model_Tpa_City::getPairCitys());                                // Request对象                $this->assign('oRequest', $this->_request);            }                        $aDebug = Util_Common::getDebugData();            if ($aDebug) {                $this->assign('__showDebugInfo__', 'showDebugInfo(' . json_encode($aDebug) . ');');            }        } else {}        $this->_assignUrl();            }    /**     * 取得是否要检查登录权限     *      * @return boolean     */    public function getCheckLogin ()    {        return $this->bCheckLogin;    }        /**     * 获取人员基本信息列表     * @param array $aAdmin     * @return array     */    public function getAdminBaseInfoList ($aAdmin = null)    {        if ($aAdmin['aList']) {            foreach ($aAdmin['aList'] as &$value) {                $value['sSex'] = $this->aSex[$value['iSex']];                $value['sRole'] = $this->aRole[$value['iRoleID']];                $value['sDept'] = $this->aDeptSet[$value['iDeptID']];            }        }        return $aAdmin;    }    }